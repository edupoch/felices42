<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
    <link href="https://fonts.googleapis.com/css2?family=Modak&display=swap" rel="stylesheet">


    <title>Felices 42, Barbadillo</title>
</head>

<body>


    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script src="node_modules/chromotome/dist/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.min.js"></script>
    <script>
        // TODO Girar letras de texto
        // TODO Meter audio leído a ritmo

        var tamano = 30;
        var refresco = 15;        

        var d = 0;
        var wWidth;
        var wHeight;
        var margenX, margenY;        
        var medio = tamano / 2;
        var objectoPaleta = chromotome.getRandom();
        var paleta = objectoPaleta.colors;
        var formas = ['ellipse', 'triangle', 'square', 'curve', 'blank'];

        var figuras = [];

        function tomaDe(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function trozoDe(distancia) {
            return Math.round(Math.random() * distancia);
        }

        function coordenada(x, y, tamano) {
            return [
                Math.round(x - tamano / 2 + tamano * Math.random()), 
                Math.round(y - tamano / 2 + tamano * Math.random())
            ];
        }
        
        function setup() {
            var $window = $(window);
            
            wWidth = $window.width();
            wHeight = $window.height();

            margenX = (wWidth - Math.floor(wWidth / tamano) * tamano) / 2;
            margenY = (wHeight - Math.floor(wHeight / tamano) * tamano) / 2;

            console.log('Creando canvas de ' + wWidth + ' x ' + wHeight + ' con márgenes de ' + margenX + ' y '+ margenY);

            createCanvas(wWidth, wHeight);            
            
            for (var x = margenX + medio; x < (wWidth - margenX); x = x + tamano) {
                for (var y = margenY + medio; y < (wHeight - margenY); y = y + tamano) {
                    figuras.push({
                        x: x,
                        y: y,
                        color: tomaDe(paleta),
                        forma: tomaDe(formas)
                    });
                }
            }
        }

        function draw() {
            if (d == 0) {
                var i;
                var a, b, c;

                clear();

                stroke(2);

                $.each(figuras, function(f, figura) {
                    var x = figura.x;
                    var y = figura.y;
                    var tamanoFigura = trozoDe(tamano);

                    fill(figura.color);
                        
                    switch(figura.forma) {
                        case 'ellipse':
                            ellipse(x, y, tamanoFigura, tamanoFigura);
                            break;

                        case 'triangle':
                            a = coordenada(x, y, tamano);
                            b = coordenada(x, y, tamano);
                            c = coordenada(x, y, tamano);

                            triangle(a[0], a[1], b[0], b[1], c[0], c[1]);
                            break;

                        case 'square': 
                            square(x - tamanoFigura / 2, y - tamanoFigura / 2, tamanoFigura);
                            break;

                        case 'rect': 
                            rect(x, y, tamanoFigura / 2, tamanoFigura / 2);
                            break;

                        case 'curve':
                            beginShape();

                            noFill();

                            a = coordenada(x, y, tamano);
                            b = coordenada(x, y, tamano);

                            curveVertex(a[0],a[1]);
                            curveVertex(a[0],a[1]);

                            for (i = 0; i < Math.random() * 5; i ++) {
                                c = coordenada(x, y, tamano);
                                curveVertex(c[0],c[1]);
                            }
                            
                            curveVertex(b[0],b[1]);
                            curveVertex(b[0],b[1]);

                            endShape();
                            break;
                    }
                });

                noStroke();
                textFont('Modak');
                textSize(100);
                fill(tomaDe(paleta));
                textAlign(CENTER, CENTER);
                text('FELIZ CUMPLEAÑOS', 0, wHeight / 2, wWidth);
            }

            d = (d + 1) % refresco;
        }
    </script>
</body>

</html>